---
layout: post
title: "18. Closure"
date: 2024-12-28
authors: ["Jay Tak"]
categories: ["Development", "Javascript"]
description: í•¨ìˆ˜ì™€ ê·¸ í•¨ìˆ˜ê°€ ì„ ì–¸í•œ ë ‰ì‹œì»¬ í™˜ê²½ì˜ ì¡°í•©, í´ë¡œì €
thumbnail: "/assets/images/gen/blog/javascript.webp"
comments: false
subscribe: false
---

> A closure is the combination of a function and the lexical environment within which that function was declared.

â€‹ Mozilla Developer Network. (n.d.). **Closures**. Retrieved December 27, 2024

## 1. í´ë¡œì €ì™€ ë ‰ì‹œì»¬ í™˜ê²½

```javascript
const x = 1;

// â‘ 
function outer() {
  const x = 10;
  const inner = function () {
    console.log(x);
  }; // â‘¡
  return inner;
}

// outer í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ë©´ ì¤‘ì²© í•¨ìˆ˜ innerë¥¼ ë°˜í™˜í•œë‹¤.
// ê·¸ë¦¬ê³  outer í•¨ìˆ˜ì˜ ì‹¤í–‰ ì»¨í…ìŠ¤íŠ¸ëŠ” ì‹¤í–‰ ì»¨í…ìŠ¤íŠ¸ ìŠ¤íƒì—ì„œ íŒë˜ì–´ ì œê±°ëœë‹¤.
const innerFunc = outer();
innerFunc(); // 10
```

ğŸ§ Q. `Outer` í•¨ìˆ˜ì˜ ì§€ì—­ë³€ìˆ˜ `x`ì˜ ê°’ì¸ 10ì´ë‹¤. ì´ë¯¸ ìƒëª… ì£¼ê¸°ê°€ ì¢…ë£Œë˜ì–´ ì‹¤í–‰ ì»¨í…ìŠ¤íŠ¸ ìŠ¤íƒì—ì„œ ì œê±°ëœ `outer` í•¨ìˆ˜ì˜ ì§€ì—­ ë³€ìˆ˜ `x`ê°€ ë‹¤ì‹œ ë¶€í™œì´ë¼ë„ í•œ ë“¯ ë™ì‘í•˜ê³  ìˆë‹¤. ë„ëŒ€ì²´ ì´ëŠ” ì–´ë–»ê²Œ ëœê±´ì¸ê±¸ê¹Œ?

Answer) `outer` í•¨ìˆ˜ì˜ ì‹¤í–‰ ì»¨í…ìŠ¤íŠ¸ëŠ” ì‹¤í–‰ ì»¨í…ìŠ¤íŠ¸ ìŠ¤íƒì—ì„œ ì œê±°ë˜ì§€ë§Œ `outer`í•¨ìˆ˜ì˜ ë ‰ì‹œì»¬ í™˜ê²½ê¹Œì§€ ì†Œë©¸í•˜ì§€ëŠ” ì•ŠëŠ”ë‹¤. <br>

<span style="color:#E4007F">`outer` í•¨ìˆ˜ì˜ ë ‰ì‹œì»¬ í™˜ê²½ì€ `inner` í•¨ìˆ˜ì˜ [[Environment]] ë‚´ë¶€ ìŠ¬ë¡¯ì— ì˜í•´ ì°¸ì¡°ë˜ê³  ìˆê³ , </span><br>

<span style="color:#3498db">`inner` í•¨ìˆ˜ëŠ” ì „ì—­ ë³€ìˆ˜ `innerfunc`ì— ì˜í•´ ì°¸ì¡°ë˜ê³  ìˆìœ¼ë¯€ë¡œ ê°€ë¹„ì§€ì»¬ë ‰ì…˜ì˜ ëŒ€ìƒì´ ë˜ì§€ ì•ŠëŠ”ë‹¤. </span>

{% include framework/shortcodes/figure.html src="/assets/images/gen/content/post_18/closure.webp" title="Nested functions and lexical environments" caption="Ungmo Lee. (2020). Modern Javascript DeepDive. wikibooks. p.396." alt="Photo of Nested functions and lexical environments" link="" target="" %}

<br><br>

## 2. í´ë¡œì €ì˜ í™œìš©

ğŸ§ Q. ê·¼ë³¸ì ìœ¼ë¡œ í´ë¡œì €ë¥¼ ì™œ ì‚¬ìš©í• ê¹Œ?

Answer)

**ì²«ì§¸**ì€ ìƒíƒœ ìœ ì§€(state preservation)ë¥¼ ìœ„í•´ì„œ<br>

=> "ë³€ìˆ˜ì˜ ê°’ì´ íŠ¹ì • í•¨ìˆ˜ê°€ í˜¸ì¶œë˜ê¸° ì „ê¹Œì§€ ë³€ê²½ë˜ì§€ ì•Šê³  ìœ ì§€í•˜ê¸° ìœ„í•´ì„œ" <br>

**ë‘˜ì§¸**ì€ ë°ì´í„° ë³´í˜¸(data encapsulation) ë° ì œì–´(controlled access)ë¥¼ ìœ„í•´ì„œ <br>

=> "ì˜¤ë¡œì§€ íŠ¹ì • í•¨ìˆ˜ë§Œ í•´ë‹¹ ë³€ìˆ˜ì˜ ê°’ì„ ë³€ê²½í•˜ê¸° ìœ„í•´ì„œ" <br>

```javascript
const increase = (function () {
  let num = 0;

  return function () {
    return ++num;
  };
})();

console.log(increase()); // 1
console.log(increase()); // 2
console.log(increase()); // 3
```

<br>

ğŸ§ Q. ì¦‰ì‹œì‹¤í–‰ í•¨ìˆ˜ ë‚´ ì„ ì–¸ëœ ë³€ìˆ˜ì™€ ìƒì„±ì í•¨ìˆ˜ê°€ ìƒì„±í•  ì¸ìŠ¤í„´ìŠ¤ì˜ í”„ë¡œí¼í‹°ê°„ ì°¨ì´ëŠ” ë¬´ì—‡ì¼ê¹Œ?

```js
// (1) ì¦‰ì‹œì‹¤í–‰í•¨ìˆ˜ ë‚´ ì„ ì–¸ëœ ë³€ìˆ˜ (private)

const Counter = (function () {
  let num = 0; // í´ë¡œì € ë³€ìˆ˜

  function Counter() {}
  Counter.prototype.increase = function () {
    return ++num;
  };

  Counter.prototype.decrease = function () {
    return num > 0 ? --num : 0;
  };

  return Counter;
}());

const counter = new Counter();

console.log(counter.increase()); // 1
console.log(counter.num); // undefined
conuter.num = 10;
console.log(counter.num); // 10
â­ï¸ í—·ê°ˆë ¸ë˜ ë¶€ë¶„
// ì´ëŠ” counterê°ì²´ì— num í”„ë¡œí¼í‹° â‰  í´ë¡œì € ë³€ìˆ˜ numê³¼ëŠ” ê´€ê³„ê°€ ì—†ë‹¤.
// í´ë¡œì € ë³€ìˆ˜ numê³¼ ì¸ìŠ¤í„´ìŠ¤ í”„ë¡œí¼í‹° numì€ ì„œë¡œ ë‹¤ë¥¸ ë ‰ì‹œì»¬ í™˜ê²½(Lexical Environment)ì— ì¡´ì¬í•˜ë©°, ì™„ì „íˆ ë³„ê°œì˜ ê°œì²´ë¡œ ë™ì‘í•œë‹¤.


// (2) ìƒì„±ì í•¨ìˆ˜ê°€ ìƒì„±í•  ì¸ìŠ¤í„´ìŠ¤ì˜ í”„ë¡œí¼í‹° (public)

const Counter = (function() {
  function Counter() {
    this.num = 0; // ì¸ìŠ¤í„´ìŠ¤ í”„ë¡œí¼í‹°ë¡œ ì •ì˜
  }

  Counter.prototype.increase = function() {
    return ++this.num; // this.num ì°¸ì¡°
  };

  Counter.prototype.decrease = function() {
    return this.num > 0 ? --this.num : 0; // this.num ì°¸ì¡°
  };

  return Counter;
}());

const counter = new Counter();
console.log(counter.increase()); // 1
console.log(counter.decrease()); // 0
console.log(counter.num); // 0 (ì™¸ë¶€ì—ì„œ ì ‘ê·¼ ê°€ëŠ¥)

```

<br>

ğŸ§ Q. ë ‰ì‹œì»¬ í™˜ê²½ì„ ê³µìœ í•˜ëŠ” í´ë¡œì €ë¥¼ ë§Œë“¤ ìˆ˜ ì—†ì„ê¹Œ?

```js
const counter = (function() {
let counter = 0;

return function (predicate) {
  counter = predicate(counter);
  return counter;
}
}());

function increase(n) {
  return ++n;
}

function decrease(n) {
  return --n;
}

console.log(counter(increase)); // 1
console.log(counter(increase)); // 2

console.log(counter(decrease)); // 1
console.log(counter(decrease)); // 0
/*
ì¦‰ì‹œ ì‹¤í–‰ í•¨ìˆ˜ë¡œ í˜¸ì¶œí•˜ë©´ ë ‰ì‹œì»¬ í™˜ê²½ì„ ê³µìœ í•˜ëŠ” í´ë¡œì €ê°€ ìƒê¸°ê³ 
ì—¬ê¸°ì— ì¦ê°€, ê°ì†Œ í•¨ìˆ˜ë¥¼ ì¸ìë¡œ ë„£ìŒìœ¼ë¡œì¨ í•´ë‹¹ í´ë¡œì €ë¥¼ ê³µìœ í•  ìˆ˜ ìˆë‹¤.
/*

```

<br>

## 3. í˜¼ë™í•˜ê¸° ì‰¬ìš´ ì¼€ì´ìŠ¤

```js
(1)
var funcs = [];
for (var i = 0; i < 3; i++) {
  funcs[i] = function() { return i; };
}
// iê°€ ì¦ê°€ëœ ìƒíƒœë¡œ ëë‚˜ê³ ,
for (var j = 0; j < funcs.length; j++) {
  console.log(funcs[j]()); // 3, 3, 3
}


(2)
var funcs = [];
for (var i = 0; i < 3; i++) {
  funcs[i] = (function(i) {
    return function() {
      return i;
    };
  }(i));
}

for (var j = 0; j < funcs.length; j++) {
  console.log(funcs[j]()) // 0, 1, 2
}
// ì¦‰ì‹œì‹¤í–‰í•¨ìˆ˜ê°€ ë°˜í™˜í•œ í•¨ìˆ˜ëŠ” í´ë¡œì €ì´ë‹¤.ìì‹ ì´ ì–¸ëœ í™˜ê²½(ìŠ¤ì½”í”„)ì— ìˆëŠ” ë³€ìˆ˜ì— ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” í•¨ìˆ˜ë¥¼ ë§í•œë‹¤.
// ì¦‰, í•¨ìˆ˜ê°€ ì™¸ë¶€ í•¨ìˆ˜ì˜ ë³€ìˆ˜ì— ì ‘ê·¼í•˜ê±°ë‚˜ ì°¸ì¡°ë¥¼ ìœ ì§€í•  ìˆ˜ ìˆìœ¼ë©´ í´ë¡œì €ë¼ê³  í•  ìˆ˜ ìˆë‹¤
// ì¦‰ì‹œ ì‹¤í–‰ í•¨ìˆ˜ ë‚´ë¶€ì˜ i ê°’ì€ ì™¸ë¶€ì—ì„œ ì ‘ê·¼í•  ìˆ˜ ì—†ì§€ë§Œ, ë°˜í™˜ëœ í•¨ìˆ˜ëŠ” ì´ ê°’ì„ ê³„ì† ì°¸ì¡°í•©ë‹ˆë‹¤.



(1-2) keyword ë³€í™” (var â†’ let)
let funcs = [];
for (let i = 0; i < 3; i++) {
  funcs[i] = function() { return i; };
}
// iê°€ ì¦ê°€ëœ ìƒíƒœë¡œ ëë‚˜ê³ ,
for (let j = 0; j < funcs.length; j++) {
  console.log(funcs[j]()); // 0, 1, 2
}
// 1. for ë£¨í”„ì˜ ë§¤ ë°˜ë³µë§ˆë‹¤ ìƒˆë¡œìš´ ë¸”ë¡ ìŠ¤ì½”í”„ê°€ ìƒì„±ëœë‹¤.
// 2. let iëŠ” í•´ë‹¹ ë¸”ë¡ ìŠ¤ì½”í”„ì—ì„œ ìƒˆë¡œ ì„ ì–¸ë˜ë¯€ë¡œ, ë°˜ë³µë§ˆë‹¤ ë‹¤ë¥¸ i ë³€ìˆ˜ê°€ ì¡´ì¬í•œë‹¤.
// 3. funcs[i]ì— ì €ì¥ëœ í•¨ìˆ˜ëŠ” ê°ê°ì˜ ë°˜ë³µì—ì„œ ìƒì„±ëœ ê³ ìœ ì˜ ië¥¼ ì°¸ì¡°í•œë‹¤.
// 4. ë”°ë¼ì„œ ê° í•¨ìˆ˜ëŠ” ìì‹ ì´ ìƒì„±ëœ ë°˜ë³µì—ì„œì˜ iê°’ì„ í´ë¡œì €ë¡œì„œ ê¸°ì–µí•˜ê³  ë°˜í™˜í•œë‹¤.

```

{% include framework/shortcodes/figure.html src="/assets/images/gen/content/post_18/blocklevelscopeClosure.webp" title="Blocklevel Scope Closure" caption="Ungmo Lee. (2020). Modern Javascript DeepDive. wikibooks. p.415." alt="Photo of Blocklevel Scope Closure" link="" target="" %}

<br><br><br>

#### <span style="color:grey">reference: ëª¨ë˜ìë°”ìŠ¤í¬ë¦½íŠ¸ Deep Dive 24ì¥. í´ë¡œì €</span>
